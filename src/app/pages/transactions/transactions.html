@let pageData = paginatedTransaction();

<div class="transactions">
  <h2 class="transaction-title">{{ 'transactions.title' | translate }}</h2>
  <!-- -->
  <div class="transaction__content">
    <div class="transaction__content-header">
      <app-reusable-input
        class="transaction__content-input"
        iconName="icon-search"
        iconPosition="right"
        [placeholder]="'transactions.searchPlaceholder' | translate"
        (input)="onSearchChange($any($event.target).value)"
      />
      <!-- -->
      <div class="transaction__content-buttons">
        <!-- Mobile buttons -->
        <app-reusable-button
          [iconName]="'icon-sort-mobile'"
          [iconOnly]="true"
          [variant]="'ghost'"
          [size]="'small'"
          (click)="openSortSheet()"
          class="transaction__content-button transaction__content-button--mobile">
        </app-reusable-button>

        <app-reusable-button
          [iconName]="'icon-filter-mobile'"
          [iconOnly]="true"
          [variant]="'ghost'"
          [size]="'small'"
          (click)="openCategorySheet()"
          class="transaction__content-button transaction__content-button--mobile">
        </app-reusable-button>

        <!-- Desktop buttons -->
        <div class="transaction__content-button--desktop transaction__dropdown">
          <span class="transaction__dropdown-label">{{ 'transactions.sortBy' | translate }}</span>
          <app-reusable-dropdown
            [options]="sortOptions()"
            [selectedValue]="selectedSort"
            [size]="'small'"
            (selectionChange)="onSortChange($event)">
          </app-reusable-dropdown>
        </div>

        <div class="transaction__content-button--desktop transaction__dropdown">
          <span class="transaction__dropdown-label">{{ 'transactions.category' | translate }}</span>
          <app-reusable-dropdown
            [options]="categoryOptions()"
            [selectedValue]="selectedCategory"
            [size]="'small'"
            (selectionChange)="onCategoryChange($event)">
          </app-reusable-dropdown>
        </div>
      </div>
      <!-- -->
    </div>
    <!-- -->
    <div class="transaction__content-rows">
      @if (filteredTransactions().length === 0 && transactions().length > 0) {
        <div class="transaction__empty-state">
          <p class="transaction__empty-state-text">{{ 'transactions.emptyState.noMatches' | translate }}</p>
          <p class="transaction__empty-state-subtext">{{ 'transactions.emptyState.tryAdjusting' | translate }}</p>
        </div>
      } @else if (transactions().length === 0) {
        <div class="transaction__empty-state">
          <p class="transaction__empty-state-text">{{ 'transactions.emptyState.noTransactions' | translate }}</p>
          <p class="transaction__empty-state-subtext">{{ 'transactions.emptyState.startAdding' | translate }}</p>
        </div>
      } @else {
        @defer (when pageData.length) {
          @for (transaction of pageData; track $index) {
            <app-transactions-row [transaction]="transaction"/>
          }
        } @placeholder  {
          @for (_ of [].constructor(ITEMS_PER_PAGE);track $index) {
            <app-transactions-skeleton/>
          }
        }
      }
    </div>
    <!---->
    @if (filteredTransactions().length > 0) {
      <div class="transaction__pagination">
        <button
          class="transaction__pagination-prev"
          (click)="handlePreviousPage()"
          [disabled]="isPrevDisabled()">
          <img  [alt]="'transactions.previousPage' | translate"
                ngSrc="./assets/images/icon-caret-left.svg"
                width="6"
                height="11"
                appLazyAttribute>
        </button>
        <div class="transaction__pagination-content">
          @for (bullets of paginationBullets();track $index) {
            <div
              (click)="typeof bullets !== 'string' && currentPage.set(bullets)"
              [class.transaction__pagination-content--active]="bullets === currentPage()"
              [style.cursor]="typeof bullets === 'string' ? 'default' : 'pointer'">
              {{bullets}}
            </div>
          }
        </div>
        <button
          class="transaction__pagination-next"
          (click)="handleNextPage()"
          [disabled]="isNextDisabled()">
          <img  [alt]="'transactions.nextPage' | translate"
                ngSrc="./assets/images/icon-caret-right.svg"
                width="6"
                height="11"
                appLazyAttribute>
        </button>
      </div>
    }
  </div>

  <!-- Sort Bottom Sheet -->
  <app-reusable-bottom-sheet
    [title]="'transactions.sortBy' | translate"
    [options]="sortOptions()"
    [selectedValue]="selectedSort"
    [isOpen]="isSortSheetOpen"
    (selectionChange)="onMobileSortChange($event)"
    (closeSheet)="closeSortSheet()">
  </app-reusable-bottom-sheet>

  <!-- Category Bottom Sheet -->
  <app-reusable-bottom-sheet
    [title]="'transactions.category' | translate"
    [options]="categoryOptions()"
    [selectedValue]="selectedCategory"
    [isOpen]="isCategorySheetOpen"
    (selectionChange)="onMobileCategoryChange($event)"
    (closeSheet)="closeCategorySheet()">
  </app-reusable-bottom-sheet>

</div>
